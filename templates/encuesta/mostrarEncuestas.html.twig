{% extends 'encuesta/index.html.twig' %}

    {% block title %}
        IdentificaTest encuesta
    {% endblock title %}
    {% block stylesheets %}
        <link href="{{ asset('css/styles.css') }}" rel="stylesheet" />
        {{ parent() }}
    {% endblock %}

{% block body_tag %}style="background-color: black; color: white;"{% endblock %}
    {% block encuestas_active %}active{% endblock %}
    {% block body_content %}
        <div class="container justify-content-center text-center" style="padding-top:150px;padding-bottom:20px;">

            <div class="row justify-content-center text-center" id="edge" STYLE="padding-bottom:70px">
                <h1 class="sizedPageTitle">ENCUESTAS DE IDENTIFICATEST</h1>
            </div>

            <div id="contenedor">
                {% for encuesta in encuestas %}
                    <div class="container rounded" style="color: white; margin-bottom: 5%;">
                        <div class="row justify-content-center" id="beforeEncuestas">
                            <div class="col-9 rounded" style="background-color: #EDDBF3">
                                <a href="/home/encuesta/{{ encuesta.id }}" id="portLink">
                                    <div class="row justify-content-center">
                                        <h1 id="h1po" class="sizedh1">{{ encuesta.title }}</h1>
                                    </div>
                                    <div class="row justify-content-center" id="portfolio">
                                        <img src={{ encuesta.img }} id="imgPort" class="sizedimg">
                                    </div>
                                </a>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>

        <div class="container" id="paginador">
            <div class="row">
                <div class="col-sm-10 col-6">
                    <ul class="pagination" id="menu">
                        <li class="page-item"><input type="button" class="page-link" onclick="previous()" id="prev" value="Anterior"></li>
                    </ul>
                </div>
                <div class="col-sm-2 col-6">
                    <ul class="pagination ul-pos" id="menu">
                        <li class="page-item"><input type="button" class="page-link" onclick="next()" id="next" value="Siguiente"></li>
                    </ul>
                </div>
            </div>
        </div>
    {% endblock %}
    {% block javaScript %}
        <script src="{{ asset('js/main.js') }}"></script>
        <script>
            var min = {{ min }};
            var max = {{ max }};
            $(document).ready(function () {
                $("#prev").hide();
            });

            function previous(){
                if (min === 1) {
                    $("#prev").hide();
                } else {
                    $("#prev").fadeIn(1000);
                    if (min === max) {
                        max = max + 3;
                    } else if ((max - min) === 2) {
                        max = max + 1;
                    } else if ((max - min) === 1) {
                        max = max + 2;
                    }
                    var data = {"min": min - 4, "max": max - 4};
                    $.ajax({
                        data:  data, //datos que se envian a traves de ajax
                        url:   '/home/encuestas/next-prev', //archivo que recibe la peticion
                        type:  'get', //método de envio
                        beforeSend: function () {
                            console.log("Procesando, espere por favor...");
                        },
                        success:  function (np_encuestas) { //una vez que el archivo recibe el request lo procesa y lo devuelve
                            cambiar(np_encuestas);
                        }
                    });
                }
            }

            function next(){
                if (max === {{ size }}) {
                    $("#next").hide();
                } else {
                    $("#next").fadeIn(1000);
                    var data = {"min": min + 4, "max": max + 4};
                    $.ajax({
                        data:  data, //datos que se envian a traves de ajax
                        url:   '/home/encuestas/next-prev', //archivo que recibe la peticion
                        type:  'get', //método de envio
                        beforeSend: function () {
                            console.log("Procesando, espere por favor...");
                        },
                        success:  function (np_encuestas) { //una vez que el archivo recibe el request lo procesa y lo devuelve
                            cambiar(np_encuestas);
                        }
                    });
                }
            }

            function showMessage($message) {
                alert("Se está mostrando la " + $message + " página");
            }

            function cambiar(np_encuestas){
                $contenedor = $("#contenedor");
                $contenedor.empty();

                $encuestas2 = JSON.parse(np_encuestas);

                for (var i = 0; i < $encuestas2.length; i++){

                    //encuestas
                    var div = document.createElement("div");
                    div.setAttribute("class", "container rounded");
                    div.setAttribute("style", "color: white; margin-bottom: 5%;");

                    var row = document.createElement("div");
                    row.setAttribute("class", "row justify-content-center");
                    row.setAttribute("id", "beforeEncuestas");

                    var col = document.createElement("div");
                    col.setAttribute("class", "col-9 rounded");
                    col.setAttribute("style", "background-color: #EDDBF3");

                    var a = document.createElement("a");
                    a.setAttribute("href", "/home/encuesta/" + $encuestas2[i].id);
                    a.setAttribute("id", "portLink");

                    var row2 = document.createElement("div");
                    row2.setAttribute("class", "row justify-content-center");

                    var h1 = document.createElement("h1");
                    h1.setAttribute("id", "h1po");
                    h1.setAttribute("class", "sizedh1");
                    h1.innerText = $encuestas2[i].title;

                    var row2_1 = document.createElement("div");
                    row2_1.setAttribute("class", "row justify-content-center");
                    row2_1.setAttribute("id", "portfolio");

                    var img = document.createElement("img");
                    img.setAttribute("src", $encuestas2[i].img);
                    img.setAttribute("id", "imgPort");
                    img.setAttribute("class", "sizedimg")

                    //appends encuestas
                    $(div).hide().appendTo($("#contenedor")).fadeIn(1000);
                    $(row).hide().appendTo(div).fadeIn(1000);
                    $(col).hide().appendTo(row).fadeIn(1000);
                    $(a).hide().appendTo(col).fadeIn(1000);
                    $(row2).hide().appendTo(a).fadeIn(1000);
                    $(h1).hide().appendTo(row2).fadeIn(1000);
                    $(row2_1).hide().appendTo(a).fadeIn(1000);
                    $(img).hide().appendTo(row2_1).fadeIn(1000);
                    window.scrollTo(0, 0);
                }

                min = $encuestas2[0].id;
                max = $encuestas2[$encuestas2.length -1].id;

                if (max === {{ size }}) {
                    console.log("se esta mostrando la ultima");
                    $("#next").hide();
                } else {
                    $("#next").fadeIn(1000);
                }
                if (min === 1) {
                    console.log("se esta mostrando la primera");
                    $("#prev").hide();
                } else {
                    $("#prev").fadeIn(1000);
                }
            }
        </script>
    {% endblock %}